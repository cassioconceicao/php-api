<script type="text/javascript">

    function search$className(term) {

        var sel = document.getElementById('$name-list');

        if (term.length > 0) {

            sel.innerHTML = "";
            sel.style.border = "none";

            var ajax = typeof XMLHttpRequest !== 'undefined' ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
            ajax.open('POST', '$url');
            ajax.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            ajax.responseType = 'json';

            ajax.onreadystatechange = function () {

                if (this.readyState === 4 && this.status === 200) {

                    if (typeof ajax.response.error !== 'undefined') {
                        sel.innerHTML = "";
                        alert(ajax.response.error);
                    } else if (ajax.response.length > 0) {
                        var list = "";
                        for (const op of ajax.response) {
                            list += "<a href=\"javascript:setSeleceted$className('" + op.value + "', '" + op.label + "')\">" + op.label + "</a>";
                        }
                        sel.innerHTML = list;
                        sel.style.border = "1px solid $borderColor";

                    } else {
                        sel.innerHTML = "";
                        sel.style.border = "none";
                    }

                } else {
                    sel.innerHTML = "";
                    sel.style.border = "none";
                }
            };

            ajax.send('action=find&term=' + term + '&limit=' + 8);
        } else {
            sel.innerHTML = "";
            sel.style.border = "none";
        }
    }

    function setSeleceted$className(value, label) {
        document.getElementById('$name').value = value;
        document.getElementById('$name-label').value = label;
        document.getElementById('$name-list').innerHTML = "";
        document.getElementById('$name-list').style.border = "none";
    }

</script>
<label for="$name-label">$label</label><br />
<input type="search" class="input" id="$name-label" placeholder="Digite para pesquisar $label" onkeyup="search$className(this.value)" size="60" />
<input type="hidden" id="$name" name="data[$name]" value="$value" />
<div id="$name-list" class="list"></div>
<script type="text/javascript">

    var descriptor = Object.getOwnPropertyDescriptor(HTMLInputElement.prototype, "value");
    var originalSet = descriptor.set;

    descriptor.set = function (val) {

        if (this.id === "$name" && val > 0) {

            var ajax = typeof XMLHttpRequest !== 'undefined' ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
            ajax.open('POST', '$url');
            ajax.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            ajax.responseType = 'json';

            ajax.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    if (typeof ajax.response.error !== 'undefined') {
                        alert(ajax.response.error);
                    } else {
                        document.getElementById('$name-label').value = ajax.response.label;
                    }
                }
            };

            ajax.send('action=find&id=' + val);
        }

        originalSet.apply(this, arguments);
    };

    Object.defineProperty(HTMLInputElement.prototype, "value", descriptor);

</script>
