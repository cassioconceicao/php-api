<script type="text/javascript">

    function search$class(term) {

        var sel = document.getElementById('$name_list');

        if (term.length > 0) {

            sel.innerHTML = "";
            sel.setAttribute('style', 'display:none');

            var ajax = typeof XMLHttpRequest !== 'undefined' ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
            ajax.open('POST', '$url');
            ajax.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            ajax.responseType = 'json';

            ajax.onreadystatechange = function () {

                if (this.readyState === 4 && this.status === 200) {

                    if(typeof ajax.response.error !== 'undefined') {
                        sel.setAttribute('style', 'display:none');
                        alert(ajax.response.error);
                    } else if(ajax.response.length > 0) {
                        var options = "";
                        for (const op of ajax.response) {
                            options += "<option value=" + op.value + ">" + op.label + "</option>";
                        }
                        sel.innerHTML = options;
                        sel.setAttribute('style', 'display:block');
                    } else {
                        sel.setAttribute('style', 'display:none');
                    }

                } else {
                    sel.setAttribute('style', 'display:none');
                }
            };

            ajax.send('action=find&term=' + term + '&limit=' + 8);
        } else {
            sel.setAttribute('style', 'display:none');
        }
    }

    function setSeleceted$class(sel) {
        sel.setAttribute('style', 'display:none');
        document.getElementById('$name').value = sel.value;
        document.getElementById('$name_label').value = sel.options[sel.selectedIndex].text;
    }

    function verifyFocus$class(event) {

        var code = event.keyCode ? event.keyCode : event.which;
        var sel = document.getElementById('$name_list');

        if(code == '40' && sel.options.length > 0) {
            document.getElementById('$name_list').focus();
            sel.value = sel.options[0].value;
        }

        if(code == '38' && sel.options.length > 0) {
            document.getElementById('$name_label').focus();
            sel.value = '';
        }

        if(code == '13' && sel.selectedIndex > -1) {
            document.getElementById('$name_label').focus();
            setSeleceted$class(sel);
        }
    }
</script>
<input id="$name_label" onkeyup="search$class(this.value)" onkeydown="verifyFocus$class(event)" size="100%" />
<input type="hidden" id="$name" name="data[$name]" />
<select id="$name_list" style="display: none" size="4" ondblclick="setSeleceted$class(this)" onkeydown="verifyFocus$class(event)"></select>
