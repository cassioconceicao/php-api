<style type="text/css">
    #$name-list a {color: #333;display: block;padding: 5px;text-decoration: none}
    #$name-list a:nth-child(even) {background: #FFFFFF}
    #$name-list a:nth-child(odd) {background: #DDFFDD}
    #$name-list a:hover {background-color: #CCFFFF}
</style>
<script type="text/javascript">

    function search$className(term) {

        var sel = document.getElementById('$name-list');

        if (term.length > 0) {

            sel.innerHTML = "";
            sel.setAttribute("style", "border: none");

            var ajax = typeof XMLHttpRequest !== 'undefined' ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
            ajax.open('POST', '$url');
            ajax.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            ajax.responseType = 'json';

            ajax.onreadystatechange = function () {

                if (this.readyState === 4 && this.status === 200) {

                    if (typeof ajax.response.error !== 'undefined') {
                        sel.innerHTML = "";
                        alert(ajax.response.error);
                    } else if (ajax.response.length > 0) {
                        var list = "";
                        for (const op of ajax.response) {
                            list += "<a href=\"javascript:setSeleceted$className('" + op.value + "', '" + op.label + "')\">" + op.label + "</a>";
                        }
                        sel.innerHTML = list;
                        sel.setAttribute("style", "border: 1px solid #CCC");

                    } else {
                        sel.innerHTML = "";
                        sel.setAttribute("style", "border: none");
                    }

                } else {
                    sel.innerHTML = "";
                    sel.setAttribute("style", "border: none");
                }
            };

            ajax.send('action=find&term=' + term + '&limit=' + 8);
        } else {
            sel.innerHTML = "";
            sel.setAttribute("style", "border: none");
        }
    }

    function setSeleceted$className(value, label) {
        document.getElementById('$name').value = value;
        document.getElementById('$name-label').value = label;
        document.getElementById('$name-list').innerHTML = "";
        document.getElementById('$name-list').setAttribute("style", "border: none");
    }

</script>
<input id="$name-label" onkeyup="search$className(this.value)" size="100%" />
<input type="hidden" id="$name" name="data[$name]" value="$value" />
<div id="$name-list"></div>
<script type="text/javascript">
    
    if(!isNaN(document.getElementById('$name').value) && document.getElementById('$name').value.length > 0) {

        var ajax = typeof XMLHttpRequest !== 'undefined' ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
        ajax.open('POST', '$url');
        ajax.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
        ajax.responseType = 'json';

        ajax.onreadystatechange = function () {
            if (this.readyState === 4 && this.status === 200) {
                if (typeof ajax.response.error !== 'undefined') {
                    alert(ajax.response.error);
                } else {
                    document.getElementById('$name-label').value = ajax.response.label;
                }
            }
        };

        ajax.send('action=find&id=' + document.getElementById('$name').value);
    }

</script>
